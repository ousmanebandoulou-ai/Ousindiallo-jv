/**
 * ========================================
 * PANIER D'ACHAT - MISE √Ä JOUR AUTOMATIQUE DES PRIX TOTAUX
 * ========================================
 * 
 * üéØ OBJECTIF : Voir le prix total ajust√© automatiquement en fonction :
 *    ‚úÖ Des changements de quantit√©
 *    ‚úÖ Des suppressions d'articles
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 1. MISE √Ä JOUR AUTOMATIQUE LORS DES CHANGEMENTS DE QUANTIT√â
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 *    ‚ûï Bouton "+" ‚Üí Augmente quantit√© ‚Üí Prix total recalcul√© IMM√âDIATEMENT
 *    ‚ûñ Bouton "-" ‚Üí Diminue quantit√© ‚Üí Prix total recalcul√© IMM√âDIATEMENT
 *    ‚å®Ô∏è Input quantit√© ‚Üí Modifie quantit√© ‚Üí Prix total recalcul√© apr√®s validation
 * 
 *    üìä MISES √Ä JOUR AUTOMATIQUES :
 *       ‚Ä¢ Sous-total de l'article (prix √ó nouvelle quantit√©)
 *       ‚Ä¢ Sous-total panier (somme de tous les articles)
 *       ‚Ä¢ Taxes (15% du sous-total)
 *       ‚Ä¢ TOTAL FINAL (sous-total + taxes)
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 2. MISE √Ä JOUR AUTOMATIQUE LORS DES SUPPRESSIONS
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 *    üóëÔ∏è Suppression d'un article ‚Üí Prix total ajust√© AUTOMATIQUEMENT
 *       ‚Ä¢ Article retir√© du calcul
 *       ‚Ä¢ Nouveau sous-total calcul√©
 *       ‚Ä¢ Taxes recalcul√©es
 *       ‚Ä¢ Total final mis √† jour
 * 
 *    üì¶ Vidage du panier ‚Üí Tous les totaux remis √† z√©ro
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 3. FORMULE DE CALCUL DES PRIX
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 *    Sous-total article = Prix unitaire √ó Quantit√©
 *    Sous-total panier = Œ£ (Sous-total de chaque article)
 *    Taxes = Sous-total panier √ó 15%
 *    TOTAL FINAL = Sous-total panier + Taxes
 * 
 * üí° Tous les prix sont mis √† jour en TEMPS R√âEL sans rechargement !
 * ========================================
 */

// Articles pr√©s√©lectionn√©s dans le panier
let panier = [
    {
        id: 1,
        nom: "Laptop Dell XPS 15",
        prix: 1299.99,
        quantite: 1,
        image: "https://via.placeholder.com/100x100?text=Laptop",
        aime: false
    },
    {
        id: 2,
        nom: "Souris sans fil Logitech",
        prix: 29.99,
        quantite: 2,
        image: "https://via.placeholder.com/100x100?text=Souris",
        aime: false
    },
    {
        id: 3,
        nom: "Clavier m√©canique RGB",
        prix: 89.99,
        quantite: 1,
        image: "https://via.placeholder.com/100x100?text=Clavier",
        aime: false
    },
    {
        id: 4,
        nom: "Webcam HD 1080p",
        prix: 59.99,
        quantite: 1,
        image: "https://via.placeholder.com/100x100?text=Webcam",
        aime: false
    }
];

// Fonction pour formater le prix en euros
function formaterPrix(prix) {
    return prix.toFixed(2) + " ‚Ç¨";
}

/**
 * Calcule le sous-total d'un article (prix unitaire √ó quantit√©)
 * @param {Object} article - L'article avec ses propri√©t√©s (prix, quantite)
 * @returns {number} Le sous-total de l'article
 */
function calculerSousTotalArticle(article) {
    return article.prix * article.quantite;
}

/**
 * Calcule le sous-total de tout le panier
 * Additionne les sous-totaux de tous les articles pr√©sents dans le panier
 * @returns {number} Le sous-total total du panier
 */
function calculerSousTotalPanier() {
    return panier.reduce((total, article) => {
        return total + calculerSousTotalArticle(article);
    }, 0);
}

/**
 * Calcule les taxes (15% du sous-total)
 * @param {number} sousTotal - Le sous-total du panier
 * @returns {number} Le montant des taxes
 */
function calculerTaxes(sousTotal) {
    return sousTotal * 0.15;
}

/**
 * Calcule le total final √† payer
 * Total = Sous-total + Taxes
 * @returns {number} Le total final √† payer
 */
function calculerTotal() {
    const sousTotal = calculerSousTotalPanier();
    const taxes = calculerTaxes(sousTotal);
    return sousTotal + taxes;
}

/**
 * Fonction pour mettre √† jour l'affichage des totaux du panier
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * MISE √Ä JOUR AUTOMATIQUE DU PRIX TOTAL
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 * Cette fonction recalcule et affiche automatiquement les prix :
 * 
 * üìä CALCUL DES PRIX :
 * 1. Sous-total article = Prix unitaire √ó Quantit√©
 * 2. Sous-total panier = Somme de tous les sous-totaux articles
 * 3. Taxes = 15% du sous-total panier
 * 4. Total final = Sous-total panier + Taxes
 * 
 * üîÑ MISE √Ä JOUR AUTOMATIQUE LORS DE :
 * - ‚úÖ Changement de quantit√© (boutons + ou -)
 * - ‚úÖ Modification directe de la quantit√© (input)
 * - ‚úÖ Suppression d'un article
 * - ‚úÖ Vidage du panier
 * - ‚úÖ Initialisation du panier
 * 
 * üé® EFFETS VISUELS :
 * - Animation de couleur lors de la mise √† jour
 * - Mise √† jour en temps r√©el sans rechargement
 * 
 * @returns {void}
 */
function mettreAJourTotaux() {
    // V√©rifier que les √©l√©ments DOM existent avant de les mettre √† jour
    const elSousTotal = document.getElementById("sousTotal");
    const elTaxes = document.getElementById("taxes");
    const elTotal = document.getElementById("total");
    
    if (!elSousTotal || !elTaxes || !elTotal) {
        // Les √©l√©ments n'existent pas encore, on ne peut pas mettre √† jour
        return;
    }
    
    // Calculer les nouveaux totaux
    const sousTotal = calculerSousTotalPanier();
    const taxes = calculerTaxes(sousTotal);
    const total = calculerTotal();
    
    // Animation de changement pour montrer que les valeurs ont √©t√© mises √† jour
    [elSousTotal, elTaxes, elTotal].forEach(element => {
        element.style.transition = "color 0.3s ease";
        element.style.color = "#667eea";
        
        setTimeout(() => {
            element.style.color = "";
        }, 300);
    });
    
    // Mettre √† jour l'affichage des valeurs
    elSousTotal.textContent = formaterPrix(sousTotal);
    elTaxes.textContent = formaterPrix(taxes);
    elTotal.textContent = formaterPrix(total);
}

// Fonction pour afficher un article dans le panier
function afficherArticle(article) {
    const panierArticles = document.getElementById("panierArticles");
    const sousTotalArticle = calculerSousTotalArticle(article);

    // Initialiser la propri√©t√© "aime" si elle n'existe pas
    if (article.aime === undefined) {
        article.aime = false;
    }

    const articleDiv = document.createElement("div");
    articleDiv.className = "cart-item";
    articleDiv.setAttribute("data-id", article.id);

    articleDiv.innerHTML = `
        <div class="item-image">
            <img src="${article.image}" alt="${article.nom}">
        </div>
        <div class="item-details">
            <div class="item-header">
                <h3 class="item-nom">${article.nom}</h3>
                <!-- Bouton c≈ìur pour aimer/ne plus aimer l'article -->
                <!-- ü§ç = C≈ìur blanc (non aim√©) | ‚ù§Ô∏è = C≈ìur rouge (aim√©) -->
                <button class="btn-aimer ${article.aime ? 'aime' : ''}" 
                        data-id="${article.id}" 
                        title="${article.aime ? 'Ne plus aimer' : 'Aimer'}">
                    <span class="coeur-icon">${article.aime ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                </button>
            </div>
            <p class="item-prix">${formaterPrix(article.prix)}</p>
        </div>
        <div class="item-quantity">
            <!-- Bouton "-" pour diminuer la quantit√© -->
            <button class="btn-quantity btn-decrease" data-id="${article.id}" title="Diminuer la quantit√©">-</button>
            <!-- Input pour afficher et modifier directement la quantit√© -->
            <input type="number" 
                   class="quantity-input" 
                   value="${article.quantite}" 
                   min="1" 
                   data-id="${article.id}">
            <!-- Bouton "+" pour augmenter la quantit√© -->
            <button class="btn-quantity btn-increase" data-id="${article.id}" title="Augmenter la quantit√©">+</button>
        </div>
        <div class="item-subtotal">
            <span class="subtotal-value">${formaterPrix(sousTotalArticle)}</span>
        </div>
        <div class="item-actions">
            <!-- Bouton pour supprimer l'article du panier -->
            <button class="btn-supprimer" data-id="${article.id}" title="Supprimer cet article du panier">üóëÔ∏è</button>
        </div>
    `;

    panierArticles.appendChild(articleDiv);

    // Ajouter les √©v√©nements pour cet article
    ajouterEvenementsArticle(articleDiv, article);
}

// Fonction pour trouver un article par son ID
function trouverArticleParId(id) {
    return panier.find(article => article.id === id);
}

/**
 * Fonction pour ajouter les √©v√©nements DOM √† un article
 * 
 * Cette fonction g√®re tous les √©v√©nements interactifs pour chaque article :
 * 
 * AJUSTEMENT DES QUANTIT√âS avec les boutons "+" et "-" :
 * - Bouton "-" : Diminue la quantit√© de 1 (minimum 1)
 *   * Si quantit√© > 1 : diminue la quantit√© et met √† jour les totaux
 *   * Si quantit√© = 1 : ne fait rien (quantit√© minimum)
 * 
 * - Bouton "+" : Augmente la quantit√© de 1 (pas de limite maximale)
 *   * Augmente toujours la quantit√© et met √† jour les totaux
 * 
 * AUTRES FONCTIONNALIT√âS :
 * - Modification directe de la quantit√© via l'input
 * - Suppression d'article (bouton üóëÔ∏è)
 * - Ajout aux favoris (bouton c≈ìur ‚ù§Ô∏è/ü§ç)
 * 
 * @param {HTMLElement} articleDiv - L'√©l√©ment DOM de l'article
 * @param {Object} article - L'objet article avec ses propri√©t√©s
 */
function ajouterEvenementsArticle(articleDiv, article) {
    const btnDecrease = articleDiv.querySelector(".btn-decrease");
    const btnIncrease = articleDiv.querySelector(".btn-increase");
    const quantityInput = articleDiv.querySelector(".quantity-input");
    const btnSupprimer = articleDiv.querySelector(".btn-supprimer");
    const btnAimer = articleDiv.querySelector(".btn-aimer");

    // ========================================
    // √âV√âNEMENT : Ajuster la quantit√© avec les boutons "+" et "-"
    // ========================================
    
    // ===== BOUTON "-" : Diminuer la quantit√© =====
    // Cliquer sur "-" r√©duit la quantit√© de 1 (minimum 1)
    btnDecrease.addEventListener("click", (e) => {
        e.preventDefault(); // Emp√™cher le comportement par d√©faut
        e.stopPropagation(); // Emp√™cher la propagation
        
        // Trouver l'article dans le panier pour avoir la r√©f√©rence √† jour
        const articleActuel = trouverArticleParId(article.id);
        
        // V√©rifier que l'article existe et que la quantit√© peut √™tre diminu√©e (minimum 1)
        if (articleActuel && articleActuel.quantite > 1) {
            // Diminuer la quantit√©
            articleActuel.quantite--;
            
            // Mettre √† jour l'affichage de l'input
            quantityInput.value = articleActuel.quantite;
            
            // Mettre √† jour le sous-total de l'article et les totaux globaux
            mettreAJourArticle(articleDiv, articleActuel);
        } else if (articleActuel && articleActuel.quantite === 1) {
            // Si la quantit√© est d√©j√† √† 1, informer l'utilisateur (optionnel)
            // La quantit√© reste √† 1, on ne fait rien
        }
    });

    // ===== BOUTON "+" : Augmenter la quantit√© =====
    // Cliquer sur "+" augmente la quantit√© de 1 (pas de limite maximale)
    btnIncrease.addEventListener("click", (e) => {
        e.preventDefault(); // Emp√™cher le comportement par d√©faut
        e.stopPropagation(); // Emp√™cher la propagation
        
        // Trouver l'article dans le panier pour avoir la r√©f√©rence √† jour
        const articleActuel = trouverArticleParId(article.id);
        
        // V√©rifier que l'article existe
        if (articleActuel) {
            // Augmenter la quantit√©
            articleActuel.quantite++;
            
            // Mettre √† jour l'affichage de l'input
            quantityInput.value = articleActuel.quantite;
            
            // Mettre √† jour le sous-total de l'article et les totaux globaux
            mettreAJourArticle(articleDiv, articleActuel);
        }
    });

    // ===== √âV√âNEMENT : Modifier la quantit√© via l'input directement =====
    quantityInput.addEventListener("change", (e) => {
        const nouvelleQuantite = parseInt(e.target.value) || 1;
        const articleActuel = trouverArticleParId(article.id);
        if (articleActuel) {
            if (nouvelleQuantite >= 1) {
                articleActuel.quantite = nouvelleQuantite;
                mettreAJourArticle(articleDiv, articleActuel);
            } else {
                // Si la quantit√© est invalide, remettre √† 1
                articleActuel.quantite = 1;
                e.target.value = 1;
                mettreAJourArticle(articleDiv, articleActuel);
            }
        }
    });

    // ===== √âV√âNEMENT : Emp√™cher la saisie de valeurs n√©gatives ou nulles =====
    quantityInput.addEventListener("input", (e) => {
        let valeur = parseInt(e.target.value);
        if (isNaN(valeur) || valeur < 1) {
            e.target.value = 1;
        }
    });

    // ========================================
    // √âV√âNEMENT : Supprimer l'article du panier (bouton üóëÔ∏è)
    // ========================================
    // Cliquer sur le bouton poubelle supprime d√©finitivement l'article du panier
    // - Demande confirmation avant de supprimer
    // - Retire l'article du tableau panier
    // - Supprime l'√©l√©ment du DOM avec animation
    // - Met √† jour automatiquement les totaux
    // - Affiche un message de confirmation
    btnSupprimer.addEventListener("click", (e) => {
        e.preventDefault(); // Emp√™cher le comportement par d√©faut
        e.stopPropagation(); // Emp√™cher la propagation de l'√©v√©nement
        
        // Appeler la fonction de suppression avec l'ID de l'article
        supprimerArticle(article.id);
    });

    // ========================================
    // √âV√âNEMENT : Aimer/Ne plus aimer avec le bouton c≈ìur ‚ù§Ô∏è/ü§ç
    // ========================================
    // Cliquer sur le bouton c≈ìur permet d'ajouter ou retirer l'article des favoris
    // - C≈ìur blanc ü§ç = article non aim√©
    // - C≈ìur rouge ‚ù§Ô∏è = article aim√© (favoris)
    // - Change de couleur en temps r√©el
    // - Animation lors du changement
    // - Affiche un message de confirmation
    btnAimer.addEventListener("click", (e) => {
        e.preventDefault(); // Emp√™cher le comportement par d√©faut
        e.stopPropagation(); // Emp√™cher la propagation de l'√©v√©nement
        
        // Appeler la fonction pour basculer l'√©tat "aimer"
        toggleAimerArticle(article.id, articleDiv);
    });
}

/**
 * Fonction pour mettre √† jour l'affichage d'un article
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * MISE √Ä JOUR AUTOMATIQUE LORS DU CHANGEMENT DE QUANTIT√â
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 * Cette fonction est appel√©e automatiquement quand :
 * - ‚ûï La quantit√© est augment√©e avec le bouton "+"
 * - ‚ûñ La quantit√© est diminu√©e avec le bouton "-"
 * - ‚å®Ô∏è La quantit√© est modifi√©e directement dans l'input
 * 
 * ACTIONS EFFECTU√âES :
 * 1. Recalcule le sous-total de l'article (prix √ó nouvelle quantit√©)
 * 2. Met √† jour l'affichage du sous-total de l'article
 * 3. Recalcule automatiquement les totaux globaux du panier :
 *    - Sous-total panier
 *    - Taxes (15%)
 *    - Total final
 * 
 * üí° Le prix total s'ajuste automatiquement en temps r√©el !
 * 
 * @param {HTMLElement} articleDiv - L'√©l√©ment DOM de l'article
 * @param {Object} article - L'objet article avec ses propri√©t√©s (prix, quantite)
 */
function mettreAJourArticle(articleDiv, article) {
    // Calculer le nouveau sous-total de l'article (prix √ó quantit√©)
    const sousTotalArticle = calculerSousTotalArticle(article);
    const subtotalValue = articleDiv.querySelector(".subtotal-value");
    
    // Mettre √† jour le sous-total affich√© de l'article
    if (subtotalValue) {
        // Animation visuelle pour montrer le changement
        subtotalValue.style.transition = "color 0.3s ease";
        subtotalValue.style.color = "#667eea";
        
        setTimeout(() => {
            subtotalValue.style.color = "";
        }, 300);
        
        subtotalValue.textContent = formaterPrix(sousTotalArticle);
    }
    
    // Mettre √† jour automatiquement les totaux globaux du panier
    // (sous-total, taxes, total final)
    mettreAJourTotaux();
}

/**
 * Fonction pour basculer l'√©tat "aimer" d'un article
 * 
 * Cette fonction g√®re le changement de couleur du c≈ìur :
 * - C≈ìur blanc ü§ç = Article non aim√© (√©tat initial)
 * - C≈ìur rouge ‚ù§Ô∏è = Article aim√© (ajout√© aux favoris)
 * 
 * FONCTIONNEMENT :
 * 1. V√©rifie que l'article existe
 * 2. Bascule l'√©tat "aimer" (true/false)
 * 3. Change l'ic√¥ne du c≈ìur (ü§ç ‚Üí ‚ù§Ô∏è ou ‚ù§Ô∏è ‚Üí ü§ç)
 * 4. Ajoute/retire la classe CSS "aime"
 * 5. Animation de zoom lors du changement
 * 6. Met √† jour le tooltip
 * 7. Affiche un message de confirmation
 * 
 * @param {number} id - L'identifiant unique de l'article
 * @param {HTMLElement} articleDiv - L'√©l√©ment DOM de l'article
 */
function toggleAimerArticle(id, articleDiv) {
    // Trouver l'article dans le panier
    const article = trouverArticleParId(id);
    
    // V√©rifier que l'article existe
    if (!article) {
        return;
    }

    // Basculer l'√©tat "aimer" (true devient false, false devient true)
    article.aime = !article.aime;
    
    // Trouver les √©l√©ments DOM du bouton c≈ìur et de l'ic√¥ne
    const btnAimer = articleDiv.querySelector(".btn-aimer");
    const coeurIcon = articleDiv.querySelector(".coeur-icon");
    
    // V√©rifier que les √©l√©ments existent
    if (btnAimer && coeurIcon) {
        // ===== ANIMATION : Effet de zoom lors du clic =====
        btnAimer.style.transform = "scale(1.2)";
        
        // Changer la couleur et l'ic√¥ne apr√®s un court d√©lai (pour l'animation)
        setTimeout(() => {
            if (article.aime) {
                // ===== ARTICLE AIM√â : C≈ìur rouge ‚ù§Ô∏è =====
                coeurIcon.textContent = "‚ù§Ô∏è"; // C≈ìur rouge
                btnAimer.classList.add("aime"); // Ajouter la classe CSS pour le style
                btnAimer.setAttribute("title", "Ne plus aimer"); // Mettre √† jour le tooltip
                
                // Message de confirmation
                afficherMessage(`"${article.nom}" a √©t√© ajout√© √† vos favoris ‚ù§Ô∏è`, "success");
            } else {
                // ===== ARTICLE NON AIM√â : C≈ìur blanc ü§ç =====
                coeurIcon.textContent = "ü§ç"; // C≈ìur blanc
                btnAimer.classList.remove("aime"); // Retirer la classe CSS
                btnAimer.setAttribute("title", "Aimer"); // Mettre √† jour le tooltip
                
                // Message de confirmation
                afficherMessage(`"${article.nom}" a √©t√© retir√© de vos favoris`, "info");
            }
            
            // Remettre le bouton √† sa taille normale apr√®s l'animation
            btnAimer.style.transform = "scale(1)";
        }, 150); // D√©lai de 150ms pour l'animation
    }
}

/**
 * Fonction pour supprimer un article du panier
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * MISE √Ä JOUR AUTOMATIQUE DU PRIX TOTAL APR√àS SUPPRESSION
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 * Cette fonction g√®re la suppression compl√®te d'un article :
 * 
 * PROCESSUS DE SUPPRESSION :
 * 1. ‚úÖ V√©rifie que l'article existe dans le panier
 * 2. ‚úÖ Demande confirmation √† l'utilisateur
 * 3. ‚úÖ Retire l'article du tableau panier
 * 4. ‚úÖ Supprime l'√©l√©ment du DOM avec animation
 * 5. ‚úÖ Met √† jour AUTOMATIQUEMENT les totaux :
 *       - Sous-total panier (sans l'article supprim√©)
 *       - Taxes recalcul√©es (15% du nouveau sous-total)
 *       - Total final ajust√©
 * 6. ‚úÖ Affiche des messages de confirmation
 * 7. ‚úÖ G√®re le cas o√π le panier devient vide
 * 
 * üí° Le prix total s'ajuste automatiquement apr√®s chaque suppression !
 * 
 * @param {number} id - L'identifiant unique de l'article √† supprimer
 */
function supprimerArticle(id) {
    // √âtape 1 : Trouver l'article √† supprimer pour afficher son nom dans la confirmation
    const articleASupprimer = trouverArticleParId(id);
    
    // V√©rifier que l'article existe
    if (!articleASupprimer) {
        afficherMessage("Article introuvable dans le panier.", "warning");
        return;
    }

    // √âtape 2 : Demander confirmation avant de supprimer (avec le nom de l'article)
    const confirmation = confirm(
        `√ätes-vous s√ªr de vouloir supprimer "${articleASupprimer.nom}" du panier ?`
    );
    
    // Si l'utilisateur confirme la suppression
    if (confirmation) {
        // √âtape 3 : Retirer l'article du tableau panier
        // Utiliser filter() pour cr√©er un nouveau tableau sans l'article supprim√©
        panier = panier.filter(article => article.id !== id);
        
        // √âtape 4 : Trouver et supprimer l'√©l√©ment DOM correspondant
        const articleDiv = document.querySelector(`.cart-item[data-id="${id}"]`);
        
        if (articleDiv) {
            // Animation de suppression (fondu et glissement vers la gauche)
            articleDiv.style.transition = "opacity 0.3s, transform 0.3s";
            articleDiv.style.opacity = "0";
            articleDiv.style.transform = "translateX(-20px)";
            
            // Supprimer l'√©l√©ment apr√®s l'animation (300ms)
            setTimeout(() => {
                articleDiv.remove();
                
                // √âtape 5 : Mettre √† jour les totaux APR√àS la suppression visuelle
                mettreAJourTotaux();
            }, 300);
        } else {
            // Si l'√©l√©ment DOM n'existe pas, mettre √† jour imm√©diatement
            mettreAJourTotaux();
        }
        
        // √âtape 6 : Afficher un message de confirmation
        afficherMessage(`"${articleASupprimer.nom}" a √©t√© supprim√© du panier.`, "success");
        
        // √âtape 7 : G√©rer le cas o√π le panier devient vide apr√®s suppression
        if (panier.length === 0) {
            setTimeout(() => {
                afficherMessage("Votre panier est maintenant vide.", "info");
                // R√©initialiser l'affichage pour montrer le message "panier vide"
                initialiserPanier();
            }, 500);
        }
    } else {
        // Si l'utilisateur annule, ne rien faire
        // (l'article reste dans le panier)
    }
}

// Fonction pour vider le panier
function viderPanier() {
    if (panier.length === 0) {
        afficherMessage("Le panier est d√©j√† vide.", "info");
        return;
    }

    if (confirm("√ätes-vous s√ªr de vouloir vider tout le panier ?")) {
        panier = [];
        document.getElementById("panierArticles").innerHTML = "";
        mettreAJourTotaux();
        afficherMessage("Le panier a √©t√© vid√© avec succ√®s.", "success");
    }
}

// Fonction pour valider la commande
function validerCommande() {
    if (panier.length === 0) {
        afficherMessage("Votre panier est vide. Veuillez ajouter des articles avant de valider.", "warning");
        return;
    }

    const total = calculerTotal();
    const message = `Commande valid√©e avec succ√®s !\n\nTotal √† payer: ${formaterPrix(total)}\n\nNombre d'articles: ${panier.length}\n\nMerci pour votre achat !`;
    
    alert(message);
    
    // Optionnel: r√©initialiser le panier apr√®s validation
    // viderPanier();
}

// Fonction pour afficher un message (optionnel, peut √™tre am√©lior√©e avec une meilleure UI)
function afficherMessage(message, type = "info") {
    // Cr√©er une notification temporaire
    const notification = document.createElement("div");
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add("show");
    }, 10);

    setTimeout(() => {
        notification.classList.remove("show");
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}

// Fonction pour initialiser le panier
function initialiserPanier() {
    const panierArticles = document.getElementById("panierArticles");
    
    if (panier.length === 0) {
        panierArticles.innerHTML = `
            <div class="empty-cart">
                <p>Votre panier est vide.</p>
            </div>
        `;
    } else {
        panierArticles.innerHTML = "";
        panier.forEach(article => {
            afficherArticle(article);
        });
    }
    
    mettreAJourTotaux();
}

// ========================================
// √âV√âNEMENTS DOM GLOBAUX
// ========================================
// Tous les √©v√©nements sont attach√©s apr√®s le chargement complet du DOM
document.addEventListener("DOMContentLoaded", () => {
    // Initialiser le panier au chargement de la page
    initialiserPanier();

    // ===== √âV√âNEMENT : Vider le panier =====
    const btnViderPanier = document.getElementById("viderPanier");
    if (btnViderPanier) {
        btnViderPanier.addEventListener("click", viderPanier);
    }

    // ===== √âV√âNEMENT : Valider la commande =====
    const btnValiderCommande = document.getElementById("validerCommande");
    if (btnValiderCommande) {
        btnValiderCommande.addEventListener("click", validerCommande);
    }
});
